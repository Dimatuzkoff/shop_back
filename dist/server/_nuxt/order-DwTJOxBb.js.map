{"version":3,"file":"order-DwTJOxBb.js","sources":["../../../../components/molecule/OrderedProducts.vue","../../../../components/organism/Delivery.vue","../../../../pages/order.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { useCartStore } from '@/stores/CartStore';\nconst cartStore = useCartStore();\n</script>\n\n\n<template>\n  <div v-if=\"cartStore.currentCart.length > 0\" class=\"order-info-description\">\n    <h2>Вы заказали:</h2>\n    <table class=\"table\">\n      <tbody>\n        <tr v-for=\"item in cartStore.currentCart\" :key=\"item.product._id\">\n          <td>{{ item.product.name }}</td>\n          <td>x {{ item.quantity }}</td>\n          <td>{{ item.product.price }} грн/шт</td>\n          <td>{{ item.product.price * item.quantity }} грн</td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"d-flex pa-2 justify-end\">\n      <span>Общая сумма заказа {{ cartStore.totalPrice }} грн</span>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.order-info-description {\n  width: 100%;\n  padding: 15px;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n\n  .table {\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 20px;\n\n    tr {\n      border-bottom: 1px solid #ddd;\n    }\n\n    td {\n      padding: 12px 20px;\n      text-align: left;\n\n      &:first-child {\n        width: 50%;\n      }\n\n      &:nth-child(2),\n      &:nth-child(3),\n      &:nth-child(4) {\n        white-space: nowrap;\n        text-align: right;\n      }\n\n      &:nth-child(2) {\n        width: 10%;\n      }\n\n      &:nth-child(3) {\n        width: 20%;\n      }\n\n      &:nth-child(4) {\n        width: 20%;\n      }\n    }\n  }\n\n  hr {\n    margin: 20px 0;\n    border: none;\n    border-top: 1px solid #ddd;\n  }\n\n  .d-flex {\n    display: flex;\n    justify-content: flex-end;\n    padding: 10px 0;\n\n    span {\n      font-weight: bold;\n      font-size: 16px;\n    }\n  }\n}\n\n@media (max-width: 450px) {\n  .table td:nth-child(3) {\n    display: none;\n  }\n}\n\n@media (min-width: 1024px) {\n  .order-info-description {\n    margin-top: 0;\n  }\n}\n</style>","<script lang=\"ts\" setup>\nimport { ref, reactive } from 'vue';\nimport axios from 'axios';\nimport { defineProps, defineEmits } from 'vue';\n\nconst cities = ref<any[]>([]);\nconst departments = ref<string[]>([]);\nconst selectedCity = ref<any | null>(null);\nconst selectedDepartment = ref<string>('');\nlet citySearchTerm = ref<string>('');\nconst isInputActive = ref<boolean>(false);\n// Конфигурация API\nconst config = useRuntimeConfig();\nconst apiUrl = config.public.apiUrl;\n\nconst emits = defineEmits(['updateCity']);\nconst props = defineProps({\n  cityError: String,\n  departmentError: String,\n});\nfunction emitCity(city: string) {\n  emits('updateCity', city);\n}\n\nfunction emitDepartment() {\n  emits('updateDepartment', selectedDepartment.value);\n  //   console.log(selectedDepartment.value);\n}\n\nasync function searchDepartment(ref: string) {\n  try {\n    const response = await axios.get(\n      `${apiUrl}/api/search-departments?CityRef=${ref}`\n    );\n    departments.value = response.data.departments.map(\n      (elem: { DescriptionRu: any }) => elem.DescriptionRu\n    );\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nasync function searchCity(city: string) {\n  try {\n    let response = await axios.get(`${apiUrl}/api/search-cities?q=${city}`);\n    cities.value = response.data.cities[0].Addresses;\n    selectedDepartment.value = '';\n    emitDepartment('');\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nfunction selectCity(city: any) {\n  selectedCity.value = city;\n  isInputActive.value = false;\n  citySearchTerm.value = city.MainDescription;\n  emitCity(city.Present);\n}\n\nwatch(\n  () => citySearchTerm.value,\n  (newValue: string, _oldValue: string) => {\n    cities.value = [];\n    if (newValue) {\n      searchCity(newValue);\n    }\n  }\n);\n\nwatch(\n  () => selectedCity.value,\n  (newValue: any, _oldValue: string) => {\n    if (newValue) {\n      searchDepartment(newValue.DeliveryCity);\n    }\n  }\n);\n</script>\n\n<template>\n  <v-container>\n    <v-row class=\"city-select\">\n      <v-col cols=\"12\" class=\"pa-0\">\n        <v-text-field\n          variant=\"solo\"\n          label=\"Введите город\"\n          @focus=\"isInputActive = true\"\n          v-model=\"citySearchTerm\"\n          :error-messages=\"cityError\"\n        ></v-text-field>\n        <div\n          :class=\"isInputActive ? 'all-cities' : 'd-none'\"\n          id=\"scroll-target\"\n          class=\"overflow-y-auto\"\n          style=\"max-height: 150px\"\n        >\n          <div\n            v-for=\"city in cities\"\n            :key=\"city.Present\"\n            class=\"city\"\n            @click=\"selectCity(city)\"\n          >\n            <span>{{ city.Present }}</span>\n          </div>\n        </div>\n      </v-col>\n    </v-row>\n\n    <!-- Поле выбора отделения -->\n    <v-row>\n      <v-col cols=\"12\" align=\"start\">\n        <v-select\n          variant=\"solo\"\n          v-model=\"selectedDepartment\"\n          :items=\"departments\"\n          label=\"Выберите отделение\"\n          item-text=\"DescriptionRu\"\n          item-value=\"Ref\"\n          :disabled=\"!selectedCity\"\n          @update:model-value=\"emitDepartment\"\n          :error-messages=\"departmentError\"\n        />\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<style scoped lang=\"scss\">\n.city-select {\n  width: 100%;\n  height: 28px;\n  z-index: 1;\n  margin: 0 auto 35px auto;\n  position: relative;\n  text-align: start;\n\n  input:focus {\n    outline: none;\n  }\n  .all-cities {\n    margin-top: -20px;\n    max-height: 150px;\n    width: 100%;\n    border-radius: 5px;\n    box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);\n    z-index: 11;\n    background-color: white;\n    text-align: start;\n  }\n  .d-none {\n    display: none;\n  }\n  .city {\n    padding: 5px 10px;\n  }\n  .city:hover {\n    background-color: rgb(203, 208, 206);\n    cursor: pointer;\n  }\n}\n</style>","<script lang=\"ts\" setup>\nimport { defineProps, ref, computed } from 'vue';\nimport { useField, useForm } from 'vee-validate';\nimport { useCartStore } from '@/stores/CartStore';\nimport { useAppStore } from '../stores/AppStore';\nconst appStore = useAppStore();\nconst cartStore = useCartStore();\n\nconst regPhone = /^\\+38 \\(0[1-9]\\d{1}\\) \\d{3} \\d{2} \\d{2}$/;\nconst regEmail = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,})+$/;\nconst { handleSubmit, handleReset } = useForm({\n  validationSchema: {\n    username(value: string) {\n      if (!value?.length) return 'Введите имя';\n      else if (value?.length >= 2) return true;\n      else return 'Имя содержит минимум 2 символа';\n    },\n    surname(value: string) {\n      if (!value?.length) return 'Введите фамилию';\n      else if (value?.length >= 2) return true;\n      else return 'Фамилия содержит минимум 2 символа';\n    },\n    phone(value: string) {\n      if (!value?.length) return 'Введите номер телефона';\n      //   if (!regPhone.test(value)) return 'Неверный формат номера';\n      return true;\n    },\n    email(value: string) {\n      if (!value?.length) return 'Введите Email';\n      if (!regEmail.test(value)) return 'Неверный формат Email';\n      return true;\n    },\n    city(value: string) {\n      if (!value?.length) return 'Введите город';\n      return true;\n    },\n    department(value: string) {\n      if (!value?.length && city.value.value) return 'Выберите отделение';\n      return true;\n    },\n  },\n});\n\nconst username = useField('username');\nconst surname = useField('surname');\nconst phone = useField('phone');\nconst email = useField('email');\nconst city = useField('city');\nconst department = useField('department');\nconst submitOrder = handleSubmit(async (values: any) => {\n  const contacts = {\n    name: username.value.value,\n    surname: surname.value.value,\n    phone: phone.value.value,\n    email: email.value.value,\n  };\n  const delivery = {\n    city: city.value.value,\n    department: department.value.value,\n  };\n\n  const result = await cartStore.addOrder(contacts, delivery);\n  if (result?.data.ok) {\n    cartStore.currentCart = [];\n    alert('Ваш заказ принят. Спасибо за покупку!');\n    handleReset();\n    city.value.value = '';\n  } else {\n    alert('Произошла ошибка при оформлении заказа. Попробуйте еще раз.');\n  }\n});\n\nif (appStore.profile) username.value.value = appStore.profile.name || '';\nif (appStore.profile) surname.value.value = appStore.profile.surname || '';\nif (appStore.profile?.phone) phone.value.value = appStore.profile.phone || '';\nif (appStore.profile?.email) email.value.value = appStore.profile.email || '';\n\nfunction onInputPhone(event: any) {\n  event.target.value = event.target.value\n    .replace('+38 (0', '')\n    .replace(/\\D/g, '')\n    .slice(0, 9);\n  const phoneRegex = /^(\\d{0,2})(\\d{0,3})(\\d{0,2})(\\d{0,2})$/;\n\n  event.target.value = event.target.value.replace(\n    phoneRegex,\n    (_match: string, p1: string, p2: string, p3: string, p4: string) => {\n      const formattedNumber = [];\n\n      if (p1) {\n        formattedNumber.push(`+38 (0${p1}`);\n      }\n      if (p2) {\n        formattedNumber.push(`) ${p2}`);\n      }\n      if (p3) {\n        formattedNumber.push(` ${p3}`);\n      }\n      if (p4) {\n        formattedNumber.push(` ${p4}`);\n      }\n\n      return formattedNumber.join('');\n    }\n  );\n  phone.value.value = event.target.value;\n}\n\nfunction updateCity(selectedCity: string) {\n  city.value.value = selectedCity;\n}\n\nfunction updateDepartment(selectedDepartment: string) {\n  department.value.value = selectedDepartment;\n}\n</script>\n\n<template>\n  <v-form class=\"order\" @submit.prevent=\"submitOrder\">\n    <v-row align=\"center\">\n      <v-col cols=\"12\" md=\"6\" class=\"contact-info\">\n        <div class=\"action\">1 Контактная информация</div>\n        <v-col cols=\"12\" class=\"pa-0 pt-2\">\n          <v-text-field\n            variant=\"solo\"\n            v-model=\"username.value.value\"\n            :error-messages=\"username.errorMessage.value\"\n            label=\"Имя\"\n          ></v-text-field>\n        </v-col>\n        <v-col cols=\"12\" class=\"pa-0\">\n          <v-text-field\n            variant=\"solo\"\n            v-model=\"surname.value.value\"\n            :error-messages=\"surname.errorMessage.value\"\n            label=\"Фамилия\"\n          ></v-text-field>\n        </v-col>\n        <v-col cols=\"12\" class=\"pa-0\">\n          <v-text-field\n            variant=\"solo\"\n            v-model=\"phone.value.value\"\n            label=\"Телефон\"\n            :error-messages=\"phone.errorMessage.value\"\n          ></v-text-field>\n        </v-col>\n        <v-col cols=\"12\" class=\"pa-0\">\n          <v-text-field\n            variant=\"solo\"\n            v-model=\"email.value.value\"\n            label=\"E-mail\"\n            :error-messages=\"email.errorMessage.value\"\n          ></v-text-field>\n        </v-col>\n      </v-col>\n      <v-col cols=\"12\" md=\"6\">\n        <molecule-OrderedProducts />\n      </v-col>\n      <v-col align=\"center\" cols=\"12\">\n        <div class=\"delivery\">\n          <div class=\"action\">2 Доставка</div>\n          <organism-Delivery\n            @updateCity=\"updateCity\"\n            @updateDepartment=\"updateDepartment\"\n            :cityError=\"city.errorMessage.value\"\n            :departmentError=\"department.errorMessage.value\"\n          />\n        </div>\n      </v-col>\n    </v-row>\n    <v-row justify=\"center\">\n      <v-btn\n        class=\"mt-4\"\n        style=\"width: 200px\"\n        text=\"Сделать заказ\"\n        type=\"submit\"\n      ></v-btn>\n    </v-row>\n  </v-form>\n</template>  \n\n<style lang=\"scss\" scoped>\n.order {\n  padding: 60px 20px 40px 20px;\n  &-info {\n    display: flex;\n    width: 100%;\n    flex-direction: column;\n    justify-content: space-around;\n    align-items: center;\n\n    .contact-info {\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n      position: relative;\n\n      .action {\n        position: absolute;\n        top: -25px;\n        left: 0;\n      }\n    }\n  }\n  .delivery {\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    max-width: 800px;\n    margin-top: 40px;\n    position: relative;\n\n    .action {\n      position: absolute;\n      top: -25px;\n      left: 0;\n    }\n  }\n}\n\n@media (min-width: 1024px) {\n  .order-info {\n    flex-direction: row;\n    justify-content: space-around;\n  }\n}\n</style>"],"names":["ref"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,UAAM,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACGZ,UAAA,SAAS,IAAW,CAAA,CAAE;AACtB,UAAA,cAAc,IAAc,CAAA,CAAE;AAC9B,UAAA,eAAe,IAAgB,IAAI;AACnC,UAAA,qBAAqB,IAAY,EAAE;AACrC,QAAA,iBAAiB,IAAY,EAAE;AAC7B,UAAA,gBAAgB,IAAa,KAAK;AAExC,UAAM,SAAS;AACT,UAAA,SAAS,OAAO,OAAO;AAE7B,UAAM,QAAQ;AAKd,aAAS,SAAS,MAAc;AAC9B,YAAM,cAAc,IAAI;AAAA,IAC1B;AAEA,aAAS,iBAAiB;AAClB,YAAA,oBAAoB,mBAAmB,KAAK;AAAA,IAEpD;AAEA,mBAAe,iBAAiBA,MAAa;AACvC,UAAA;AACI,cAAA,WAAW,MAAM,MAAM;AAAA,UAC3B,GAAG,MAAM,mCAAmCA,IAAG;AAAA,QAAA;AAErC,oBAAA,QAAQ,SAAS,KAAK,YAAY;AAAA,UAC5C,CAAC,SAAiC,KAAK;AAAA,QAAA;AAAA,eAElC,OAAO;AACd,gBAAQ,IAAI,KAAK;AAAA,MACnB;AAAA,IACF;AAEA,mBAAe,WAAW,MAAc;AAClC,UAAA;AACE,YAAA,WAAW,MAAM,MAAM,IAAI,GAAG,MAAM,wBAAwB,IAAI,EAAE;AACtE,eAAO,QAAQ,SAAS,KAAK,OAAO,CAAC,EAAE;AACvC,2BAAmB,QAAQ;AAC3B,uBAAe,EAAE;AAAA,eACV,OAAO;AACd,gBAAQ,IAAI,KAAK;AAAA,MACnB;AAAA,IACF;AAEA,aAAS,WAAW,MAAW;AAC7B,mBAAa,QAAQ;AACrB,oBAAc,QAAQ;AACtB,qBAAe,QAAQ,KAAK;AAC5B,eAAS,KAAK,OAAO;AAAA,IACvB;AAEA;AAAA,MACE,MAAM,eAAe;AAAA,MACrB,CAAC,UAAkB,cAAsB;AACvC,eAAO,QAAQ;AACf,YAAI,UAAU;AACZ,qBAAW,QAAQ;AAAA,QACrB;AAAA,MACF;AAAA,IAAA;AAGF;AAAA,MACE,MAAM,aAAa;AAAA,MACnB,CAAC,UAAe,cAAsB;AACpC,YAAI,UAAU;AACZ,2BAAiB,SAAS,YAAY;AAAA,QACxC;AAAA,MACF;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvEF,UAAM,WAAW;AACjB,UAAM,YAAY;AAGlB,UAAM,WAAW;AACjB,UAAM,EAAE,cAAc,YAAY,IAAI,QAAQ;AAAA,MAC5C,kBAAkB;AAAA,QAChB,SAAS,OAAe;AACtB,cAAI,EAAC,+BAAO;AAAe,mBAAA;AAAA,oBAClB,+BAAO,WAAU;AAAU,mBAAA;AAAA;AACxB,mBAAA;AAAA,QACd;AAAA,QACA,QAAQ,OAAe;AACrB,cAAI,EAAC,+BAAO;AAAe,mBAAA;AAAA,oBAClB,+BAAO,WAAU;AAAU,mBAAA;AAAA;AACxB,mBAAA;AAAA,QACd;AAAA,QACA,MAAM,OAAe;AACnB,cAAI,EAAC,+BAAO;AAAe,mBAAA;AAEpB,iBAAA;AAAA,QACT;AAAA,QACA,MAAM,OAAe;AACnB,cAAI,EAAC,+BAAO;AAAe,mBAAA;AACvB,cAAA,CAAC,SAAS,KAAK,KAAK;AAAU,mBAAA;AAC3B,iBAAA;AAAA,QACT;AAAA,QACA,KAAK,OAAe;AAClB,cAAI,EAAC,+BAAO;AAAe,mBAAA;AACpB,iBAAA;AAAA,QACT;AAAA,QACA,WAAW,OAAe;AACxB,cAAI,EAAC,+BAAO,WAAU,KAAK,MAAM;AAAc,mBAAA;AACxC,iBAAA;AAAA,QACT;AAAA,MACF;AAAA,IAAA,CACD;AAEK,UAAA,WAAW,SAAS,UAAU;AAC9B,UAAA,UAAU,SAAS,SAAS;AAC5B,UAAA,QAAQ,SAAS,OAAO;AACxB,UAAA,QAAQ,SAAS,OAAO;AACxB,UAAA,OAAO,SAAS,MAAM;AACtB,UAAA,aAAa,SAAS,YAAY;AAClC,UAAA,cAAc,aAAa,OAAO,WAAgB;AACtD,YAAM,WAAW;AAAA,QACf,MAAM,SAAS,MAAM;AAAA,QACrB,SAAS,QAAQ,MAAM;AAAA,QACvB,OAAO,MAAM,MAAM;AAAA,QACnB,OAAO,MAAM,MAAM;AAAA,MAAA;AAErB,YAAM,WAAW;AAAA,QACf,MAAM,KAAK,MAAM;AAAA,QACjB,YAAY,WAAW,MAAM;AAAA,MAAA;AAG/B,YAAM,SAAS,MAAM,UAAU,SAAS,UAAU,QAAQ;AACtD,UAAA,iCAAQ,KAAK,IAAI;AACnB,kBAAU,cAAc;AACxB,cAAM,uCAAuC;AACjC;AACZ,aAAK,MAAM,QAAQ;AAAA,MAAA,OACd;AACL,cAAM,8DAA8D;AAAA,MACtE;AAAA,IAAA,CACD;AAED,QAAI,SAAS;AAAS,eAAS,MAAM,QAAQ,SAAS,QAAQ,QAAQ;AACtE,QAAI,SAAS;AAAS,cAAQ,MAAM,QAAQ,SAAS,QAAQ,WAAW;AACxE,SAAI,cAAS,YAAT,mBAAkB;AAAO,YAAM,MAAM,QAAQ,SAAS,QAAQ,SAAS;AAC3E,SAAI,cAAS,YAAT,mBAAkB;AAAO,YAAM,MAAM,QAAQ,SAAS,QAAQ,SAAS;AAiC3E,aAAS,WAAW,cAAsB;AACxC,WAAK,MAAM,QAAQ;AAAA,IACrB;AAEA,aAAS,iBAAiB,oBAA4B;AACpD,iBAAW,MAAM,QAAQ;AAAA,IAC3B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}