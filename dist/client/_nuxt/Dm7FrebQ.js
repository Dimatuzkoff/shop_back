import{u as q}from"./DYHMA_ZV.js";import{S as F,H as s,o as g,c as E,a as n,F as A,L as N,t as S,O as H,p as j,e as L,_ as P,r as V,h as B,K as T,w as l,b as a,ak as J,Y as K,W,I as O,J as Y,V as G,U as Q}from"./dlBUJPxP.js";import{a as I,V as m}from"./4c4Tojpe.js";import{i as D,e as X,g as C,h as Z}from"./B34bF4Mc.js";import{d as ee}from"./_65was-Q.js";import{V as te}from"./DOYfp3UE.js";import"./CIZ9W13C.js";import"./BICbpnbA.js";import"./BtsD_yie.js";const ae=i=>(j("data-v-c6ed96e1"),i=i(),L(),i),re={key:0,class:"order-info-description"},se=ae(()=>n("h2",null,"Вы заказали:",-1)),le={class:"table"},oe={class:"d-flex pa-2 justify-end"},ne=F({__name:"OrderedProducts",setup(i){const o=q();return(_,b)=>s(o).currentCart.length>0?(g(),E("div",re,[se,n("table",le,[n("tbody",null,[(g(!0),E(A,null,N(s(o).currentCart,u=>(g(),E("tr",{key:u.product._id},[n("td",null,S(u.product.name),1),n("td",null,"x "+S(u.quantity),1),n("td",null,S(u.product.price)+" грн/шт",1),n("td",null,S(u.product.price*u.quantity)+" грн",1)]))),128))])]),n("div",oe,[n("span",null,"Общая сумма заказа "+S(s(o).totalPrice)+" грн",1)])])):H("",!0)}}),ie=P(ne,[["__scopeId","data-v-c6ed96e1"]]),ue=["onClick"],ce=F({__name:"Delivery",props:{cityError:String,departmentError:String},emits:["updateCity"],setup(i,{emit:o}){const _=V([]),b=V([]),u=V(null),y=V("");let c=V("");const d=V(!1),p=W().public.apiUrl,f=o;function x(r){f("updateCity",r)}function $(){f("updateDepartment",y.value)}async function M(r){try{const e=await O.get(`${p}/api/search-departments?CityRef=${r}`);b.value=e.data.departments.map(t=>t.DescriptionRu)}catch(e){console.log(e)}}async function R(r){try{let e=await O.get(`${p}/api/search-cities?q=${r}`);_.value=e.data.cities[0].Addresses,y.value="",$("")}catch(e){console.log(e)}}function U(r){u.value=r,d.value=!1,c.value=r.MainDescription,x(r.Present)}return B(()=>c.value,(r,e)=>{_.value=[],r&&R(r)}),B(()=>u.value,(r,e)=>{r&&M(r.DeliveryCity)}),(r,e)=>(g(),T(te,null,{default:l(()=>[a(I,{class:"city-select"},{default:l(()=>[a(m,{cols:"12",class:"pa-0"},{default:l(()=>[a(D,{variant:"solo",label:"Введите город",onFocus:e[0]||(e[0]=t=>d.value=!0),modelValue:s(c),"onUpdate:modelValue":e[1]||(e[1]=t=>J(c)?c.value=t:c=t),"error-messages":i.cityError},null,8,["modelValue","error-messages"]),n("div",{class:K([d.value?"all-cities":"d-none","overflow-y-auto"]),id:"scroll-target",style:{"max-height":"150px"}},[(g(!0),E(A,null,N(_.value,t=>(g(),E("div",{key:t.Present,class:"city",onClick:k=>U(t)},[n("span",null,S(t.Present),1)],8,ue))),128))],2)]),_:1})]),_:1}),a(I,null,{default:l(()=>[a(m,{cols:"12",align:"start"},{default:l(()=>[a(ee,{variant:"solo",modelValue:y.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>y.value=t),$],items:b.value,label:"Выберите отделение","item-text":"DescriptionRu","item-value":"Ref",disabled:!u.value,"error-messages":i.departmentError},null,8,["modelValue","items","disabled","error-messages"])]),_:1})]),_:1})]),_:1}))}}),de=P(ce,[["__scopeId","data-v-fe58f695"]]),z=i=>(j("data-v-4311d507"),i=i(),L(),i),me=z(()=>n("div",{class:"action"},"1 Контактная информация",-1)),pe={class:"delivery"},fe=z(()=>n("div",{class:"action"},"2 Доставка",-1)),_e=F({__name:"order",setup(i){var U,r;const o=Y(),_=q(),b=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,})+$/,{handleSubmit:u,handleReset:y}=X({validationSchema:{username(e){return e!=null&&e.length?(e==null?void 0:e.length)>=2?!0:"Имя содержит минимум 2 символа":"Введите имя"},surname(e){return e!=null&&e.length?(e==null?void 0:e.length)>=2?!0:"Фамилия содержит минимум 2 символа":"Введите фамилию"},phone(e){return e!=null&&e.length?!0:"Введите номер телефона"},email(e){return e!=null&&e.length?b.test(e)?!0:"Неверный формат Email":"Введите Email"},city(e){return e!=null&&e.length?!0:"Введите город"},department(e){return!(e!=null&&e.length)&&f.value.value?"Выберите отделение":!0}}}),c=C("username"),d=C("surname"),h=C("phone"),p=C("email"),f=C("city"),x=C("department"),$=u(async e=>{const t={name:c.value.value,surname:d.value.value,phone:h.value.value,email:p.value.value},k={city:f.value.value,department:x.value.value},w=await _.addOrder(t,k);w!=null&&w.data.ok?(_.currentCart=[],alert("Ваш заказ принят. Спасибо за покупку!"),y(),f.value.value=""):alert("Произошла ошибка при оформлении заказа. Попробуйте еще раз.")});o.profile&&(c.value.value=o.profile.name||""),o.profile&&(d.value.value=o.profile.surname||""),(U=o.profile)!=null&&U.phone&&(h.value.value=o.profile.phone||""),(r=o.profile)!=null&&r.email&&(p.value.value=o.profile.email||"");function M(e){f.value.value=e}function R(e){x.value.value=e}return(e,t)=>{const k=ie,w=de;return g(),T(Z,{class:"order",onSubmit:Q(s($),["prevent"])},{default:l(()=>[a(I,{align:"center"},{default:l(()=>[a(m,{cols:"12",md:"6",class:"contact-info"},{default:l(()=>[me,a(m,{cols:"12",class:"pa-0 pt-2"},{default:l(()=>[a(D,{variant:"solo",modelValue:s(c).value.value,"onUpdate:modelValue":t[0]||(t[0]=v=>s(c).value.value=v),"error-messages":s(c).errorMessage.value,label:"Имя"},null,8,["modelValue","error-messages"])]),_:1}),a(m,{cols:"12",class:"pa-0"},{default:l(()=>[a(D,{variant:"solo",modelValue:s(d).value.value,"onUpdate:modelValue":t[1]||(t[1]=v=>s(d).value.value=v),"error-messages":s(d).errorMessage.value,label:"Фамилия"},null,8,["modelValue","error-messages"])]),_:1}),a(m,{cols:"12",class:"pa-0"},{default:l(()=>[a(D,{variant:"solo",modelValue:s(h).value.value,"onUpdate:modelValue":t[2]||(t[2]=v=>s(h).value.value=v),label:"Телефон","error-messages":s(h).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(m,{cols:"12",class:"pa-0"},{default:l(()=>[a(D,{variant:"solo",modelValue:s(p).value.value,"onUpdate:modelValue":t[3]||(t[3]=v=>s(p).value.value=v),label:"E-mail","error-messages":s(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(m,{cols:"12",md:"6"},{default:l(()=>[a(k)]),_:1}),a(m,{align:"center",cols:"12"},{default:l(()=>[n("div",pe,[fe,a(w,{onUpdateCity:M,onUpdateDepartment:R,cityError:s(f).errorMessage.value,departmentError:s(x).errorMessage.value},null,8,["cityError","departmentError"])])]),_:1})]),_:1}),a(I,{justify:"center"},{default:l(()=>[a(G,{class:"mt-4",style:{width:"200px"},text:"Сделать заказ",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])}}}),we=P(_e,[["__scopeId","data-v-4311d507"]]);export{we as default};
